import sys
import subprocess
 
def run_psql(psql_script):
    connectstr = sys.argv[1]
    p = subprocess.Popen(['psql', connectstr], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    (stdout, stderr) = p.communicate(psql_script)
    stdout_lines = stdout.split("\n")
    stderr_lines = stderr.split("\n")
 
    return stdout_lines, stdout
 
try:
    filename = sys.argv[2]
    psql_script = filename
    print("Starting psql process")
    psql_output, err = run_psql(psql_script)
    print("Below are the logs")
    for line in psql_output:
        print(line)
    if "ERROR" in err:
        if "ERROR:" in err:
            print("An error occurred")
        else:
            print("Success")
    else:
        print("Success")
except:
    print("An error occurred")
