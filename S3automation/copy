import sys
import subprocess

def run_sqlplus(sqlplus_script):
    connectstr=sys.argv[1]
    p = subprocess.Popen(['sqlplus','-s',connectstr],stdin=subprocess.PIPE,stdout=subprocess.PIPE,stderr=subprocess.PIPE)
    (stdout,stderr) = p.communicate(sqlplus_script)
    stdout_lines = stdout.split("\n")
    stderr_lines = stderr.split("\n")

    return stdout_lines,stdout;

try:
    filename='@' + sys.argv[2]
    sqlplus_script=filename
    print("starting sql process")
    sqlplus_output,err = run_sqlplus(sqlplus_script)
    print("below are the logs")
    for line in sqlplus_output:
        print(line)
    if "ERROR" in err:
        if "ORA-" in err:
            print("an error occurred")
        else:
            print("success")
    else:
        print("success")
except:
    print("an error occurred")
