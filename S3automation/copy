---
- name: Send email with S3 URL and weekly metrics reports link
  hosts: localhost
  # vars_files:
  #   - ../config/mailNotification-config.yaml
  tasks:
    - name: Get today's date
      command: date +'%d-%m-%Y'
      register: today_date

    - name: Create S3 URL
      set_fact:
        s3_url: "https://devopssit-misc-artifacts.s3.amazonaws.com/weekly-metrics-reports/{{ today_date.stdout }}/"

    - name: Send email
      mail:
         host: "mailrelay-prod.meta.spectrum.net"
         from: "Mobile2.0-DevOps <Mobile2.0-DevOps@charter.com>"
         to: "C-Venugopal.Velagani@charter.com,C-Akriti.Babbar@charter.com,C-Purushotham.Tumuluri@charter.com,C-Sanket.Kurane@charter.com"
         subject: "Weekly Metrics Reports for NSL/NE for EKS, RDS and API gateway health checks"
         body: |
          Hi ALl,
          Please find the Weekly Metrics Reports for NSL/NE for EKS, RDS and API gateway health checks:
          {{ s3_url }}
          
          Thanks,
          MDA-SRE Team.
      delegate_to: localhost
